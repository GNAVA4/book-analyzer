# Book Analyzer Service üìö

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö –∫–Ω–∏–≥ (PDF, DOCX, TXT) —Å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º –≤ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π XML.

## üåü –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ PDF**: —Å–æ—á–µ—Ç–∞–Ω–∏–µ –±—ã—Å—Ç—Ä—ã—Ö —ç–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –∏ –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞ (LLM).
- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ —Ä–∞–∑–¥–µ–ª–æ–≤ (–ì–ª–∞–≤—ã -> –ü–æ–¥—Ä–∞–∑–¥–µ–ª—ã).
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ DOCX**: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∏–ª–µ–π –∏ **–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–æ—Ä–º—É–ª (OMML)** –≤ —á–∏—Ç–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç.
- **–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞**: —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω—Ç–∏—Ç—É–ª–æ–≤, –º—É—Å–æ—Ä–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤ —Å—Ç—Ä–∞–Ω–∏—Ü –∏ —Å–∫–ª–µ–∏–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤.

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- **Backend**: Python 3.11, FastAPI, Uvicorn
- **PDF Engine**: PyMuPDF (fitz)
- **DOCX Engine**: python-docx, lxml
- **AI Engine**: Ollama (–º–æ–¥–µ–ª—å Qwen 2.5)

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```bash
git init
git clone <—Å—Å—ã–ª–∫–∞_–Ω–∞_–≤–∞—à_—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π>
cd book-analyzer
```
### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
python -m venv venv
# –î–ª—è Windows:
venv\Scripts\activate
# –î–ª—è Linux/macOS:
source venv/bin/activate

pip install -r requirements.txt
```
### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Ollama
–î–ª—è —Ä–∞–±–æ—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏ "–ù–µ–π—Ä–æ—Å–µ—Ç—å (Qwen 2.5)" –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä LLM:

1.  –°–∫–∞—á–∞–π—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ **Ollama** —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ [ollama.com](https://ollama.com/).
2.  –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Ollama.
3.  –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ —Å–∫–∞—á–∞–π—Ç–µ –º–æ–¥–µ–ª—å –∫–æ–º–∞–Ω–¥–æ–π:
```bash
ollama run qwen2.5:7b
```
### 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä —Å –ø–æ–º–æ—â—å—é Uvicorn:
```bash
uvicorn app.main:app --reload
```
–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É: http://127.0.0.1:8000

## ü§ñ –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è –ø–æ–∏—Å–∫–∞

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º **Sequential Lock** (–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–º–æ–∫):

*   **–¢–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤**: –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —á–∞—Å—Ç–∏, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–π—Ç–∏ –µ–≥–æ –≤ —Ç–µ–∫—Å—Ç–µ –¥–∞–∂–µ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –ª–∏—à–Ω–∏—Ö —Ç–æ—á–µ–∫, –ø—Ä–æ–±–µ–ª–æ–≤ –∏–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ —Å—Ç—Ä–æ–∫.
*   **–õ–∏–Ω–µ–π–Ω–æ—Å—Ç—å**: –ø–æ–∏—Å–∫ –ì–ª–∞–≤—ã 2 –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –ì–ª–∞–≤—ã 1, —á—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–µ ¬´–º—É—Å–æ—Ä–Ω—ã—Ö¬ª –ø–æ–≤—Ç–æ—Ä–æ–≤ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É.
*   **–ó–æ–Ω–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏—è**: –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–∞—Ö–æ–¥–∏—Ç –≥—Ä–∞–Ω–∏—Ü—ã —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è –≤ –Ω–∞—á–∞–ª–µ –∫–Ω–∏–≥–∏ –∏ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –∏—Ö –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞
**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:**
*   `app/api.py` ‚Äî –º–∞—Ä—à—Ä—É—Ç—ã FastAPI –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ WebSockets.
*   `app/services/pdf_utils.py` ‚Äî —è–¥—Ä–æ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ Regex-–∞–ª–≥–æ—Ä–∏—Ç–º–∞.
*   `app/services/toc_parser.py` ‚Äî —ç–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—è.
*   `app/services/xml_builder.py` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è XML —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π —Å–∏–º–≤–æ–ª–æ–≤.